{"version":3,"file":"xcodeSticker.js","sourceRoot":"","sources":["../src/xcodeSticker.ts"],"names":[],"mappings":"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","sourcesContent":["import { XcodeProject } from \"@expo/config-plugins\";\nimport path from \"path\";\nimport util from \"util\";\n// @ts-ignore\nimport pbxFile from \"xcode/lib/pbxFile\";\n\nexport function getMainPBXGroup(proj: XcodeProject) {\n  const project = proj.pbxProjectSection()[proj.getFirstProject().uuid];\n\n  if (!project || !project.mainGroup) {\n    return null;\n  }\n\n  const groupObj = proj.hash.project.objects.PBXGroup[project.mainGroup];\n  if (!groupObj) {\n    return null;\n  }\n  return { id: project.mainGroup, obj: groupObj };\n}\n\nexport function addStickerResourceFile(\n  proj: XcodeProject,\n  path: string,\n  rootFolderName: string\n) {\n  const opt: Record<string, any> = {};\n\n  let file = new pbxFile(path, opt);\n  if (proj.hasFile(file.path)) {\n    return false;\n  }\n\n  file.uuid = proj.generateUuid();\n  file.target = opt ? opt.target : undefined;\n\n  correctForResourcesPath(file, proj);\n  file.fileRef = proj.generateUuid();\n\n  // create stickers group\n  const stickersKey = proj.pbxCreateGroup(\n    // Without quotes, this breaks the xcode project\n    `\"${rootFolderName}\"`,\n    `\"${rootFolderName}\"`\n  );\n\n  proj.addToPbxBuildFileSection(file); // PBXBuildFile\n  // proj.addToPbxResourcesBuildPhase(file); // PBXResourcesBuildPhase\n  // ^ the above was written as a shortcut, I guess nobody expected there to be another BuildPhase\n  //   var self = proj;\n  const addToPbxStickersBuildPhase = function (file: any) {\n    // use the name Stickers instead of Resources to identify the new BuildPhase\n    const sources = proj.buildPhaseObject(\n      \"PBXResourcesBuildPhase\",\n      // \"Resources\",\n      rootFolderName,\n      // Resources,\n      file.target\n    );\n    sources.files.push(pbxBuildPhaseObj(file));\n  };\n\n  addToPbxStickersBuildPhase(file);\n\n  // PBXFileReference\n  proj.addToPbxFileReferenceSection(file);\n  proj.addToPbxGroup(file, stickersKey);\n\n  // Push the Stickers Info.plist\n  file = new pbxFile(\"Info.plist\", opt);\n  if (proj.hasFile(file.path)) {\n    return false;\n  }\n  file.uuid = proj.generateUuid();\n  correctForResourcesPath(file, proj, rootFolderName);\n  file.fileRef = proj.generateUuid();\n  // PBXFileReference\n  proj.addToPbxFileReferenceSection(file);\n  proj.addToPbxGroup(file, stickersKey);\n\n  return stickersKey;\n}\n\nconst isaXCBuildConfiguration = \"XCBuildConfiguration\";\nconst pbxTargetDependency = \"PBXTargetDependency\";\nconst pbxContainerItemProxy = \"PBXContainerItemProxy\";\n\nexport function addStickersTarget(\n  proj: XcodeProject,\n  name: string,\n  bundleId: string,\n  subfolder: string\n) {\n  // Setup uuid and name of new target\n  let targetUuid = proj.generateUuid();\n  let targetType = \"app_extension_messages_sticker_pack\";\n  let targetName = name.trim();\n  const bundleName = subfolder.trim().split(\" \").join(\"-\");\n\n  // Check type against list of allowed target types\n  if (!targetName) {\n    throw new Error(\"Target name missing.\");\n  }\n\n  // Check type against list of allowed target types\n  if (!targetType) {\n    throw new Error(\"Target type missing.\");\n  }\n\n  // Check type against list of allowed target types\n  if (!producttypeForTargettype(targetType)) {\n    throw new Error(\"Target type invalid: \" + targetType);\n  }\n\n  const PRODUCT_BUNDLE_IDENTIFIER = `\"${bundleId}.${bundleName}\"`;\n  const INFOPLIST_FILE = `\"${subfolder}/Info.plist\"`;\n\n  const commonBuildSettings = {\n    ASSETCATALOG_COMPILER_APPICON_NAME: '\"iMessage App Icon\"',\n    CLANG_ANALYZER_NONNULL: \"YES\",\n    CLANG_ANALYZER_NUMBER_OBJECT_CONVERSION: \"YES_AGGRESSIVE\",\n    CLANG_CXX_LANGUAGE_STANDARD: '\"gnu++14\"',\n    CLANG_ENABLE_OBJC_WEAK: \"YES\",\n    CLANG_WARN_DOCUMENTATION_COMMENTS: \"YES\",\n    CLANG_WARN_QUOTED_INCLUDE_IN_FRAMEWORK_HEADER: \"YES\",\n    CLANG_WARN_UNGUARDED_AVAILABILITY: \"YES_AGGRESSIVE\",\n    CODE_SIGN_STYLE: \"Automatic\",\n    DEBUG_INFORMATION_FORMAT: \"dwarf\",\n    GCC_C_LANGUAGE_STANDARD: \"gnu11\",\n    INFOPLIST_FILE,\n    IPHONEOS_DEPLOYMENT_TARGET: \"14.5\",\n    MTL_FAST_MATH: \"YES\",\n    PRODUCT_BUNDLE_IDENTIFIER,\n    PRODUCT_NAME: `\"$(TARGET_NAME)\"`,\n    SKIP_INSTALL: \"YES\",\n    TARGETED_DEVICE_FAMILY: `\"1,2\"`,\n  };\n  // Build Configuration: Create\n  const buildConfigurationsList = [\n    {\n      name: \"Debug\",\n      isa: isaXCBuildConfiguration,\n      buildSettings: {\n        ...commonBuildSettings,\n        MTL_ENABLE_DEBUG_INFO: \"INCLUDE_SOURCE\",\n      },\n    },\n    {\n      name: \"Release\",\n      isa: isaXCBuildConfiguration,\n      buildSettings: {\n        ...commonBuildSettings,\n        COPY_PHASE_STRIP: \"NO\",\n      },\n    },\n  ];\n\n  const existing = proj.hash.project.objects[isaXCBuildConfiguration];\n\n  for (const [, config] of Object.entries(existing)) {\n    if (typeof config === \"string\") continue;\n\n    if (\n      (config as any).buildSettings.ASSETCATALOG_COMPILER_APPICON_NAME &&\n      (config as any).buildSettings.ASSETCATALOG_COMPILER_APPICON_NAME.match(\n        /iMessage App Icon/\n      )\n    ) {\n      // Has existing setup...\n      // TODO: sync old values with potentially new values...\n      return false;\n    }\n  }\n\n  // Build Configuration: Add\n  const buildConfigurations = proj.addXCConfigurationList(\n    buildConfigurationsList,\n    \"Release\",\n    `Build configuration list for PBXNativeTarget ${quoted(targetName)} `\n  );\n\n  // Product: Create\n  const productName = targetName;\n  const productType = producttypeForTargettype(targetType);\n  const productFileType = filetypeForProducttype(productType);\n  const productFile = proj.addProductFile(productName, {\n    group: \"Embed App Extensions\",\n    target: targetUuid,\n    explicitFileType: productFileType,\n  });\n\n  // stickers\n  productFile.settings = productFile.settings || {};\n  productFile.settings.ATTRIBUTES = [\"RemoveHeadersOnCopy\"];\n\n  // Product: Add to build file list\n  proj.addToPbxBuildFileSection(productFile);\n\n  const strippedTargetName = path.basename(targetName, \".appex\");\n  const quotedTargetName = quoted(strippedTargetName);\n\n  // Target: Create\n  const target = {\n    uuid: targetUuid,\n    pbxNativeTarget: {\n      isa: \"PBXNativeTarget\",\n      name: quotedTargetName,\n      productName: quotedTargetName,\n      productReference: productFile.fileRef,\n      productType: quoted(producttypeForTargettype(targetType)),\n      buildConfigurationList: buildConfigurations.uuid,\n      buildPhases: [],\n      buildRules: [],\n      dependencies: [],\n    },\n  };\n\n  // Target: Add to PBXNativeTarget section\n  proj.addToPbxNativeTargetSection(target);\n\n  // Product: Embed (only for \"extension\"-type targets)\n  // Create CopyFiles phase in first target\n  const { buildPhase } = proj.addBuildPhase(\n    [],\n    \"PBXCopyFilesBuildPhase\",\n    \"Embed App Extensions\",\n    proj.getFirstTarget().uuid,\n    // targetType,\n    \"app_extension\"\n  );\n\n  // TODO: Add to https://github.com/apache/cordova-node-xcode/blob/8b98cabc5978359db88dc9ff2d4c015cba40f150/lib/pbxProject.js#L1604\n  buildPhase.dstSubfolderSpec = 13;\n\n  addToPbxCopyfilesBuildPhase(proj, productFile, \"Embed App Extensions\");\n\n  // need to add another buildphase\n  // filePathsArray, buildPhaseType, comment, target\n  proj.addBuildPhase([], \"PBXResourcesBuildPhase\", subfolder, targetUuid);\n\n  // Target: Add uuid to root project\n  proj.addToPbxProjectSection(target);\n\n  // const pbxTargetDependencySection = proj.hash.project.objects[pbxTargetDependency];\n  // These need to be defined in projects that don't have them already\n  if (!proj.hash.project.objects[pbxTargetDependency]) {\n    proj.hash.project.objects[pbxTargetDependency] = {};\n  }\n  if (!proj.hash.project.objects[pbxContainerItemProxy]) {\n    proj.hash.project.objects[pbxContainerItemProxy] = {};\n  }\n\n  proj.addTargetDependency(proj.getFirstTarget().uuid, [target.uuid]);\n\n  // Set the creation tools and provisioning....\n  if (\n    !proj.pbxProjectSection()[proj.getFirstProject().uuid].attributes\n      .TargetAttributes\n  ) {\n    proj.pbxProjectSection()[\n      proj.getFirstProject().uuid\n    ].attributes.TargetAttributes = {};\n  }\n  proj.pbxProjectSection()[\n    proj.getFirstProject().uuid\n  ].attributes.TargetAttributes[target.uuid] = {\n    CreatedOnToolsVersion: \"12.5\",\n    ProvisioningStyle: \"Automatic\",\n  };\n\n  return target;\n}\n\ntype PBXFile = any;\n\n// Copied over from xcode package for public\n\nfunction correctForResourcesPath(\n  file: PBXFile,\n  project: XcodeProject,\n  name: string = \"Resources\"\n) {\n  return correctForPath(file, project, name);\n}\n\nfunction correctForPath(file: PBXFile, project: XcodeProject, group: string) {\n  const r_group_dir = new RegExp(\"^\" + group + \"[\\\\\\\\/]\");\n\n  const _group = project.pbxGroupByName(group);\n  if (_group && _group.path) {\n    file.path = file.path.replace(r_group_dir, \"\");\n  }\n\n  return file;\n}\n\nfunction addToPbxCopyfilesBuildPhase(\n  proj: XcodeProject,\n  file: PBXFile,\n  name: string\n) {\n  const sources = proj.buildPhaseObject(\n    \"PBXCopyFilesBuildPhase\",\n    name || \"Copy Files\",\n    file.target\n  );\n  sources.files.push(pbxBuildPhaseObj(file));\n}\n\nfunction producttypeForTargettype(targetType: string): string {\n  const PRODUCTTYPE_BY_TARGETTYPE: Record<string, string> = {\n    application: \"com.apple.product-type.application\",\n    app_extension: \"com.apple.product-type.app-extension\",\n    bundle: \"com.apple.product-type.bundle\",\n    command_line_tool: \"com.apple.product-type.tool\",\n    dynamic_library: \"com.apple.product-type.library.dynamic\",\n    framework: \"com.apple.product-type.framework\",\n    static_library: \"com.apple.product-type.library.static\",\n    unit_test_bundle: \"com.apple.product-type.bundle.unit-test\",\n    watch_app: \"com.apple.product-type.application.watchapp\",\n    watch2_app: \"com.apple.product-type.application.watchapp2\",\n    watch_extension: \"com.apple.product-type.watchkit-extension\",\n    watch2_extension: \"com.apple.product-type.watchkit2-extension\",\n    // Custom\n    app_extension_messages_sticker_pack:\n      \"com.apple.product-type.app-extension.messages-sticker-pack\",\n  };\n\n  return PRODUCTTYPE_BY_TARGETTYPE[targetType];\n}\n\nfunction filetypeForProducttype(productType: string) {\n  const FILETYPE_BY_PRODUCTTYPE: Record<string, string> = {\n    \"com.apple.product-type.application\": '\"wrapper.application\"',\n    \"com.apple.product-type.app-extension\": '\"wrapper.app-extension\"',\n    \"com.apple.product-type.bundle\": '\"wrapper.plug-in\"',\n    \"com.apple.product-type.tool\": '\"compiled.mach-o.dylib\"',\n    \"com.apple.product-type.library.dynamic\": '\"compiled.mach-o.dylib\"',\n    \"com.apple.product-type.framework\": '\"wrapper.framework\"',\n    \"com.apple.product-type.library.static\": '\"archive.ar\"',\n    \"com.apple.product-type.bundle.unit-test\": '\"wrapper.cfbundle\"',\n    \"com.apple.product-type.application.watchapp\": '\"wrapper.application\"',\n    \"com.apple.product-type.application.watchapp2\": '\"wrapper.application\"',\n    \"com.apple.product-type.watchkit-extension\": '\"wrapper.app-extension\"',\n    \"com.apple.product-type.watchkit2-extension\": '\"wrapper.app-extension\"',\n    // Custom\n    \"com.apple.product-type.app-extension.messages-sticker-pack\":\n      '\"wrapper.app-extension\"',\n  };\n\n  return FILETYPE_BY_PRODUCTTYPE[productType];\n}\n\nfunction pbxBuildPhaseObj(file: PBXFile) {\n  const obj = Object.create(null);\n\n  obj.value = file.uuid;\n  obj.comment = longComment(file);\n\n  return obj;\n}\n\nfunction longComment(file: PBXFile) {\n  return util.format(\"%s in %s\", file.basename, file.group);\n}\n\nfunction quoted(str: string) {\n  return util.format(\"%s\", str);\n}\n"]}